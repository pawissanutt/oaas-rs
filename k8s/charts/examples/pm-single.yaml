# Example values for deploying PM with etcd and multiple CRMs

replicaCount: 1

image:
  repository: ghcr.io/pawissanutt/oaas-rs/pm
  tag: dev-alpha
  pullPolicy: Always

service:
  type: NodePort
  port: 8080
  targetPort: 8080
  # Expose via a fixed NodePort (optional; omit to let Kubernetes assign)
  nodePort: 30180

logging:
  level: info,oprc_pm=debug
  format: plain

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

config:
  server:
    host: 0.0.0.0
    port: 8080

  # Storage backend: etcd
  storage:
    type: etcd
    etcd:
      # For external etcd, set endpoints; for embedded etcd, leave blank
      endpoints: ""
      tls:
        insecure: true

  # CRM configuration
  crm:
    # Default fallback
    default:
      url: "http://oaas-crm-1-oprc-crm.oaas.svc.cluster.local:8088"
      timeout: 30
      retryAttempts: 3
    healthCheckInterval: 60
    healthCacheTtl: 15
    circuitBreaker:
      failureThreshold: 5
      timeout: 60

    # Multi-CRM configuration (YAML list; chart converts to JSON env var)
    clusters:
      - name: oaas-1
        url: "http://oaas-crm-1-oprc-crm.oaas.svc.cluster.local:8088"
        timeout: 30
        retry_attempts: 3
    defaultCluster: "oaas-1"

# Enable embedded etcd managed by the PM chart
embeddedEtcd:
  enabled: true
  replicas: 1
  storage:
    enabled: false
  ports:
    client: 2379
    peer: 2380