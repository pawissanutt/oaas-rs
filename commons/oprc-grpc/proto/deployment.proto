syntax = "proto3";
package oaas.deployment;

import "common.proto";
import "runtime.proto"; // For ClassRuntimeSummary
import "deployment_types.proto"; // Shared leaf types

service DeploymentService {
  rpc Deploy(DeployRequest) returns (DeployResponse);
  rpc GetDeploymentStatus(GetDeploymentStatusRequest) returns (GetDeploymentStatusResponse);
  rpc DeleteDeployment(DeleteDeploymentRequest) returns (DeleteDeploymentResponse);
  // Browse ClassRuntime objects tracked by the CRM (summary view)
  rpc ListClassRuntimes(ListClassRuntimesRequest) returns (ListClassRuntimesResponse);
  // Fetch a single ClassRuntime by deployment_id (summary view)
  rpc GetClassRuntime(GetClassRuntimeRequest) returns (GetClassRuntimeResponse);
}

// A coarse summary of a deployment's state for list views and quick filtering.
// (Removed SummarizedStatus & leaf types; now in deployment_types.proto)

message DeployRequest { DeploymentUnit deployment_unit = 1; }

message DeployResponse {
  oaas.common.StatusCode status = 1;
  string deployment_id = 2;
  optional string message = 3;
}

message GetDeploymentStatusRequest {
  string deployment_id = 1;
}

message GetDeploymentStatusResponse {
  oaas.common.StatusCode status = 1;
  optional DeploymentUnit deployment = 2;
  optional string message = 3;
  // Direct status-level resource refs (may include transient objects not embedded in deployment summary)
  repeated ResourceReference status_resource_refs = 4;
}

message DeleteDeploymentRequest {
  string deployment_id = 1;
}

message DeleteDeploymentResponse {
  oaas.common.StatusCode status = 1;
  optional string message = 2;
}

// Optional CRM-side record browsing APIs
message ListClassRuntimesRequest {
  // Optional filters
  optional string package_name = 1;
  optional string class_key = 2;
  optional string target_env = 3;
  optional string status = 4; // provider-defined summary
  // Pagination
  optional uint32 limit = 10;
  optional uint32 offset = 11;
}

message ListClassRuntimesResponse { repeated oaas.runtime.ClassRuntimeSummary items = 1; }

message GetClassRuntimeRequest {
  string deployment_id = 1;
}

message GetClassRuntimeResponse { optional oaas.runtime.ClassRuntimeSummary deployment = 1; }

// ODGM configuration embedded in DeploymentUnit
// OdgmConfig / InvocationRoutes / FunctionRoute moved to deployment_types.proto
