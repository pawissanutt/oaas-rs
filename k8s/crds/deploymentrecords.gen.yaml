apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: deploymentrecords.oaas.io
spec:
  group: oaas.io
  names:
    categories: []
    kind: DeploymentRecord
    plural: deploymentrecords
    shortNames: []
    singular: deploymentrecord
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for DeploymentRecordSpec via `CustomResource`
        properties:
          spec:
            properties:
              addons:
                default:
                - odgm
                description: Simple addon list; defaults to ["odgm"] when omitted to enable core data services.
                items:
                  type: string
                nullable: true
                type: array
              function:
                description: Function runtime container hints
                nullable: true
                properties:
                  image:
                    description: OCI image for function runtime (required ΓÇô no default fallback)
                    nullable: true
                    type: string
                  port:
                    description: Container port exposed by the function runtime
                    format: int32
                    nullable: true
                    type: integer
                type: object
              nfr:
                description: NFR configuration (enforcement toggles/mode); observe-only by default
                nullable: true
                properties:
                  enforcement:
                    nullable: true
                    properties:
                      dimensions:
                        description: Which dimensions to enforce when mode=enforce (replicas|memory|cpu)
                        items:
                          type: string
                        nullable: true
                        type: array
                      mode:
                        description: off | observe | enforce (default observe)
                        nullable: true
                        type: string
                    type: object
                type: object
              nfr_requirements:
                description: Non-functional requirements to guide template selection (heuristic)
                nullable: true
                properties:
                  availability_pct:
                    description: Target availability percentage (e.g., 99.9)
                    format: float
                    nullable: true
                    type: number
                  consistency:
                    description: Consistency preference (e.g., "eventual" or "strong")
                    nullable: true
                    type: string
                  max_latency_ms:
                    description: Maximum acceptable 95th percentile latency in milliseconds
                    format: uint32
                    minimum: 0.0
                    nullable: true
                    type: integer
                  min_throughput_rps:
                    description: Minimum target throughput in requests per second
                    format: uint32
                    minimum: 0.0
                    nullable: true
                    type: integer
                type: object
              odgm_config:
                description: ODGM configuration, currently collection-focused
                nullable: true
                properties:
                  collections:
                    description: Logical collection names this Class expects
                    items:
                      type: string
                    nullable: true
                    type: array
                  partition_count:
                    description: Desired partition count for each collection (default 1)
                    format: int32
                    nullable: true
                    type: integer
                  replica_count:
                    description: Desired replica count per partition (provided by PM; default 1)
                    format: int32
                    nullable: true
                    type: integer
                  shard_type:
                    description: Shard type (e.g., "mst", "raft", etc.) default "mst"
                    nullable: true
                    type: string
                type: object
              selected_template:
                description: Optional explicit template selection (e.g., "dev", "edge", "cloud")
                nullable: true
                type: string
            type: object
          status:
            nullable: true
            properties:
              conditions:
                items:
                  properties:
                    last_transition_time:
                      nullable: true
                      type: string
                    message:
                      nullable: true
                      type: string
                    reason:
                      nullable: true
                      type: string
                    status:
                      enum:
                      - 'True'
                      - 'False'
                      - Unknown
                      type: string
                    type:
                      enum:
                      - Available
                      - Progressing
                      - Degraded
                      - NfrObserved
                      - Unknown
                      type: string
                  required:
                  - status
                  - type
                  type: object
                nullable: true
                type: array
              last_applied_at:
                description: Timestamp when the latest recommendations were applied
                nullable: true
                type: string
              last_applied_recommendations:
                description: Audit trail of the latest applied set of recommendations (M5)
                items:
                  properties:
                    basis:
                      description: Basis (e.g., "p99_latency over 10m"), optional
                      nullable: true
                      type: string
                    component:
                      description: Component name (e.g., "function" or "odgm")
                      type: string
                    confidence:
                      description: Confidence [0..1], optional
                      format: float
                      nullable: true
                      type: number
                    dimension:
                      description: 'Dimension: replicas|memory|cpu'
                      type: string
                    target:
                      description: Target value (unit depends on dimension; e.g., replicas count, bytes)
                      format: double
                      type: number
                  required:
                  - component
                  - dimension
                  - target
                  type: object
                nullable: true
                type: array
              last_updated:
                nullable: true
                type: string
              message:
                nullable: true
                type: string
              nfr_recommendations:
                description: Observe-only recommendations produced by the analyzer (M4)
                items:
                  properties:
                    basis:
                      description: Basis (e.g., "p99_latency over 10m"), optional
                      nullable: true
                      type: string
                    component:
                      description: Component name (e.g., "function" or "odgm")
                      type: string
                    confidence:
                      description: Confidence [0..1], optional
                      format: float
                      nullable: true
                      type: number
                    dimension:
                      description: 'Dimension: replicas|memory|cpu'
                      type: string
                    target:
                      description: Target value (unit depends on dimension; e.g., replicas count, bytes)
                      format: double
                      type: number
                  required:
                  - component
                  - dimension
                  - target
                  type: object
                nullable: true
                type: array
              observed_generation:
                format: int64
                nullable: true
                type: integer
              phase:
                nullable: true
                type: string
              resource_refs:
                description: Provider-visible child resources for traceability (e.g., ServiceMonitor/PodMonitor)
                items:
                  properties:
                    kind:
                      type: string
                    name:
                      type: string
                  required:
                  - kind
                  - name
                  type: object
                nullable: true
                type: array
            type: object
        required:
        - spec
        title: DeploymentRecord
        type: object
    served: true
    storage: true
    subresources:
      status: {}

